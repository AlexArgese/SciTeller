services:
  frontend:
    build:
      context: ./AIScientistStoryteller
    image: sciteller/frontend
    depends_on:
      - backend
      - authapi
    ports:
      - "8080:80"
    networks: [scinet]

  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
      args:
        DP_USERNAME: oauth2
        DP_ACCESS_TOKEN: ${DP_ACCESS_TOKEN}
    environment:
      REMOTE_GPU_URL: http://host.docker.internal:9000
      DOCPARSE_BIN: docparse
      API_KEY: ${API_KEY}
    expose:
      - "8000"
    networks: [scinet]

  authapi:
    build:
      context: ./auth-api
    image: sciteller/authapi
    environment:
      NODE_ENV: production
      NEXTAUTH_URL: http://localhost:8080
      NEXTAUTH_SECRET: ${NEXTAUTH_SECRET}
      AUTH_SECRET: ${AUTH_SECRET}
      NEXTAUTH_TRUST_HOST: "true"
      AUTH_TRUST_HOST: "true"

      DATABASE_URL: ${DATABASE_URL}

      GOOGLE_CLIENT_ID: ${GOOGLE_CLIENT_ID}
      GOOGLE_CLIENT_SECRET: ${GOOGLE_CLIENT_SECRET}
      GITHUB_ID: ${GITHUB_ID}
      GITHUB_SECRET: ${GITHUB_SECRET}
      
      AUTH_GOOGLE_ID: ${GOOGLE_CLIENT_ID}
      AUTH_GOOGLE_SECRET: ${GOOGLE_CLIENT_SECRET}
      AUTH_GITHUB_ID: ${GITHUB_ID}
      AUTH_GITHUB_SECRET: ${GITHUB_SECRET}
      AUTH_URL: ${AUTH_URL}
      AUTH_DEBUG: "true"

    expose:
      - "3000"
    networks: [scinet]

networks:
  scinet:
    driver: bridge
